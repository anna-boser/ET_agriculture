---
title: "counterfactual vs agriculture"
author: "Anna Boser"
date: '2022-03-08'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(ggplot2)
library(here)
library(tidyr)
library(parallel)
```

```{r}
data <- fread(here("data", "for_analysis", "full_grid_time_invariant_cv.csv"))
data <- data[agriculture == 1 | counterfactual == 1,]
data <- pivot_longer(data, cols = c("agriculture", "counterfactual"), names_to = "landcover")
data <- filter(data, value == 1)
data$value = NULL
data <- filter(data, elevation >=-300, aspect >=-300, slope >=-300)
```

```{r}
ggplot(data) +
  geom_density(aes(x = soil, col = landcover))
```

```{r}
ggplot(data) +
  geom_density(aes(x = elevation, col = landcover))
```

```{r}
ggplot(data) +
  geom_density(aes(x = aspect, col = landcover))
```

```{r}
ggplot(data) +
  geom_density(aes(x = slope, col = landcover))
```

# how far is the furthest agriculture from counterfactual? 
```{r}
dist <- fread(here("data", "outputs", "distance_ag_counter.csv"))
```

```{r}
ggplot(dist) + geom_histogram(aes(x=mindist))
ggplot(dist) + geom_point(aes(x=x, y=y, col=mindist))
```

One degree lat/lon is about 100km. I know that that gives me real bad estimates. 10km would also be bad. 1km would definitely be good, and that's the average distance... 

```{r}
summary(dist)
```


Workflow:
1. Take a random sample of 1/1000 of ag points and find the distance to their closest counterfactual pixel
2. optimize hyperparameters for the order of magnitude of the median
3. test on groupings with the size of the order of magnitude of the maximum, median, and mean distance. 


